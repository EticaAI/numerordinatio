<!doctype html>
<html lang="la">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous"
    referrerpolicy="no-referrer">
  <link rel="icon" href="img/favicon.png">
  <title>Numerordĭnātĭo pictūrae</title>
  <style>
    :root {
      /* --bcp47-language: 'lat,prs'; */
      --bcp47-language: 'lat';
    }

    details>details {
      padding-left: 2em;
    }

    [data-hide-significatum="1"] dl [data-significatum="1"] {
      display: none;
    }
  </style>
  <!-- https://www.w3.org/wiki/Dynamic_style_-_manipulating_CSS_with_JavaScript -->
  <style id="picturam-stylesheet">

  </style>
</head>

<body>
  <h1>Numerordĭnātĭo pictūrae</h1>

  <div id="picturam-notitia">
    <ul>
      <li>Exemplum: <a target="_blank"
          href='./picturam.html#?peritum={"json_iri":"data/exemplum/scientiae-communitatem--sexualitatem.json"}'>./picturam.html#?peritum={"json_iri":"data/exemplum/scientiae-communitatem--sexualitatem.json"}</a>
      </li>
      <li>Exemplum: <a target="_blank"
          href='./picturam.html#?peritum={"json_data":{"10":{},"10:1":{"lat-Latn":{"0":"Exemplum"},"prs-Arab":{"0":"مثال"},"rus-Cyrl":{"0":"Пример"}}}}'>./picturam.html#?peritum={"json_data":{"10":{},"10:1":{"lat-Latn":{"0":"Exemplum"},"prs-Arab":{"0":"مثال"},"rus-Cyrl":{"0":"Пример"}}}}</a>
      </li>
      <li>Exemplum: <a target="_blank"
          href='./picturam.html#?peritum={"json_form":{"10":{},"10:1":{"lat-Latn":{"0":"Exemplum"},"prs-Arab":{"0":"مثال"},"rus-Cyrl":{"0":"Пример"}}}}'>./picturam.html#?peritum={"json_form":{"10":{},"10:1":{"lat-Latn":{"0":"Exemplum"},"prs-Arab":{"0":"مثال"},"rus-Cyrl":{"0":"Пример"}}}}</a>
      </li>
    </ul>
  </div>
  <div class="row">
    <div class="col">
      <div class="form-check form-switch">
        <input class="form-check-input instrumentum-optionem" type="checkbox" role="switch" id="ce" checked>
        <label class="form-check-label" for="ce">
          Expānsiōnem de conceptum
        </label>
      </div>
      <div class="form-check form-switch">
        <!-- <input class="form-check-input instrumentum-optionem" type="checkbox" role="switch" id="se" checked> -->
        <input class="form-check-input instrumentum-optionem" type="checkbox" role="switch" id="se">
        <label class="form-check-label" for="se">
          Expānsiōnem de significātum
        </label>
      </div>
    </div>
    <div class="col">
      <div class="input-group mb-3">
        <span class="input-group-text" id="cl_label">BCP47 linguam</span>
        <input type="text" name="cl" id="cl" class="form-control instrumentum-optionem" placeholder="lat, arb, grk"
          aria-label="BCP47 linguam" aria-describedby="cl_label" value="">
      </div>
    </div>
    <div class="col">
      <div class="input-group mb-3">
        <span class="input-group-text" id="cs_label">BCP47 scriptum</span>
        <input type="text" name="cs" id="cs" class="form-control instrumentum-optionem" placeholder="Latn, Zyyy, Zmth"
          aria-label="BCP47 scriptum" aria-describedby="cs_label">
      </div>
    </div>
  </div>

  <div class="row">
    <div id="picturam-form" class="col" style="display: none">
      <div class="mb-3">
        <button type="button" class="btn btn-primary actionem" id="picturam-form-actionem" style="width: 100%;">
          āctiōnem
        </button>
      </div>
      <textarea style="width: 100%; height: auto; min-height: 20em;" id="picturam-form-textarea"></textarea>
    </div>
    <!-- <div id="picturam-html" class="col" data-hide-significatum=""> -->
    <div id="picturam-html" class="col" data-hide-significatum="1">
    </div>
  </div>

  <div class="d3_svg_demo2"></div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
    integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"
    referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.2.1/d3.min.js"
    integrity="sha512-wkduu4oQG74ySorPiSRStC0Zl8rQfjr/Ty6dMvYTmjZw6RS5bferdx8TR7ynxeh79ySEp/benIFFisKofMjPbg=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="module">
    import * as Picturam from './lib/numerordinatio-picturam.mjs';

    let peritum_defallo = {
      'json_iri': null,
      'data': null,
    }

    let pic_html = new Picturam.PicturamDL(d3, '#picturam-html')
    let pic_exemplum = document.getElementById('picturam-notitia')

    function render(data) {
      pic_exemplum.innerHTML = ''
      pic_html.estData(data)
      let crudum_html = pic_html.inHtml()
      let wp = document.getElementById('picturam-html')
      wp.innerHTML = crudum_html
      render_optionem()
    }

    function picturam_css(object_de_array, stylesheet_id = 'picturam-stylesheet'){
      let picturamStylesheet = document.getElementById(stylesheet_id)
      let crudumStylesheet = []
      console.log(picturamStylesheet)
      console.log(object_de_array)

      for (let [selector, optionem] of Object.entries(object_de_array)) {
        crudumStylesheet.push(`${selector} {\n  ${optionem.join(";\n  ")}\n}`)
      }

      picturamStylesheet.innerHTML = crudumStylesheet.join("\n")
    }
    window.picturam_css = picturam_css

    // picturam_css({
    //   'dl [data-bcp47-language="Lat" i]': [
    //     'display: none;'
    //   ],
    //   'dl [data-bcp47-language="lat" i]': [
    //     'display: none;'
    //   ],
    // })

    function render_optionem() {
      let picturam_css_optionem = {}
      console.log('render_optionem')
      let details = document.querySelectorAll('#picturam-html details');
      // let significatum = document.querySelectorAll('[data-significatum]');
      [...details].map(item => document.getElementById('ce').checked ? item.setAttribute("open", 1) : item.removeAttribute("open"))

      let cl_val = document.querySelector('#cl')
      let cl_val_list = cl_val.value.split(',').map(item => item.trim()).filter(item => item)
      if (cl_val_list && cl_val_list.length > 0) {
        for (let rem of cl_val_list) {
          picturam_css_optionem[`dl [data-bcp47-language="${rem}" i]`] = ['display: block !important;']
        }
      }

      let cs_val = document.querySelector('#cs')
      let cs_val_list = cs_val.value.split(',').map(item => item.trim()).filter(item => item)
      if (cs_val_list && cs_val_list.length > 0) {
        for (let rem of cs_val_list) {
          picturam_css_optionem[`dl [data-bcp47-script="${rem}" i]`] = ['display: block !important;']
        }
      }
      console.log('picturam_css_optionem', picturam_css_optionem)
      picturam_css(picturam_css_optionem)


      // if (document.getElementById('ce').checked) {
      //   [...details].map(item => item.setAttribute("open", document.getElementById('ce').checked))
      // }
    }
    window.render_optionem = render_optionem

    // http://git.workspace.localhost/EticaAI/numerordinatio/docs/picturam.html#?peritum={"json_iri":"data/exemplum/scientiae-communitatem--sexualitatem.json"}
    function fontem_data_peritum(functionem_regressae) {
      let resultatum = peritum_defallo
      // console.log('fontem_data_peritum...')
      if (document.location.hash.indexOf('#?peritum=') > -1) {
        let crudum = document.location.hash.replace('#?peritum=', '')
        let decodedURI = ''
        let decodecodedURIJSONdedURI = null
        // console.log(crudum, decodeURI(crudum))
        try {
          decodedURI = decodeURI(crudum).replace(/^\'+|\'+$/g, '')
          // console.log('decodedURI', decodedURI)
          decodecodedURIJSONdedURI = JSON.parse(decodedURI)
          // console.log('decodecodedURIJSONdedURI', decodecodedURIJSONdedURI)

          resultatum.json_iri = decodecodedURIJSONdedURI.json_iri || null
          resultatum.json_data = decodecodedURIJSONdedURI.json_data || null
          resultatum.json_form = decodecodedURIJSONdedURI.json_form || null

        } catch (error) {
          console.log('error resultatum', resultatum)
        }
        if (resultatum.json_iri) {
          console.log('resultatum.json_iri', resultatum.json_iri)
          d3.json(resultatum.json_iri).then((data) => {
            render(data)
          })
        } else if (resultatum.json_data) {
          console.log('resultatum.json_data', resultatum.json_data)
          render(resultatum.json_data)
        } else if (resultatum.json_form) {
          console.log('resultatum.json_form', resultatum.json_form)
          document.getElementById('picturam-form').style.display = 'block'
          document.getElementById('picturam-form-textarea').value = JSON.stringify(resultatum.json_form, null, 2)
          document.getElementById('picturam-form-actionem').addEventListener('click', function (el) {
            let json_data = JSON.parse(document.getElementById('picturam-form-textarea').value)
            render(json_data)
          })
          // $('#picturam-form').toggle()
          render(resultatum.json_form)
        } else {
          console.log('no json_iri', resultatum)
        }
      }
      console.log(resultatum)
    }

    let picturam_html_wp = document.getElementById('picturam-html')
    let instrumentum_optionem = document.getElementsByClassName('instrumentum-optionem')
    let list = [...instrumentum_optionem]
    list.map(item => item.addEventListener('change', render_optionem))

    // @see https://css-tricks.com/almanac/selectors/a/attribute/
    // @see https://css-tricks.com/a-complete-guide-to-data-attributes/
    document.getElementById('se').addEventListener('change', function (el) {
      // console.log('changed', el.checked, el)
      if (el.target.checked) {
        picturam_html_wp.removeAttribute("data-hide-significatum")
      } else {
        picturam_html_wp.setAttribute("data-hide-significatum", "1")
      }
    })
    // document.getElementById('cl').addEventListener('change', function (el) {
    //   let rem = cl.value.split(',').map(item => item.trim())

    //   // console.log('changed', el.checked, el)
    //   console.log(cl.value)
    //   console.log('rem', rem)
    //   if (rem && rem.length > 0) {
    //     rem.forEach(language => {
    //       picturam_html_wp.setAttribute("data-show-bcp47-language", language)
    //     });
    //   } else {
    //     picturam_html_wp.removeAttribute("data-hide-significatum")
    //   }
    // })

    // function fontem_data(functionem_regressae) {
    //   let _functionem_regressae = functionem_regressae || console.log
    //   let de_hash = {}
    //   let _hash = document.location.hash
    //   if (_hash.indexOf('#?json_iri=') > -1) {
    //     let json_iri = _hash.replace('#?json_iri=', '')

    //     d3.json(json_iri).then((data) => {
    //       functionem_regressae(data)
    //     });
    //   }
    //   functionem_regressae(de_hash)
    // }

    fontem_data_peritum()
    // fontem_data(function (data) {
    //   render(data)
    // })


    // d3.json("data/exemplum/scientiae-communitatem--sexualitatem.json").then((data) => {
    //   render(data)
    // });
  </script>
</body>

</html>
